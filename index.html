<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login - CodePulse</title>
    <link rel="stylesheet" href="login.css" />
    <link rel="stylesheet" href="style.css" />
    <style>
      .login-choice {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
        margin-top: 2rem;
      }

      .login-btn {
        padding: 1rem 2rem;
        background: linear-gradient(
          135deg,
          var(--accent-color),
          var(--gold-accent)
        );
        color: white;
        border: none;
        border-radius: 10px;
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: 0.3s ease;
      }

      .login-btn:hover {
        transform: scale(1.05);
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
      }

      .back-btn {
        margin-top: 1rem;
        background: #6c757d;
        color: white;
        padding: 0.75rem 1.5rem;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        transition: 0.3s;
      }

      .back-btn:hover {
        background: #5a6268;
        transform: translateY(-2px);
      }

      .login-form {
        display: none;
        margin-top: 1.5rem;
      }

      .login-section h2 {
        margin-bottom: 0.5rem;
      }

      .error-message {
        margin-top: 1rem;
        color: #ff6b6b;
        background: rgba(255, 107, 107, 0.1);
        padding: 0.5rem;
        border-radius: 8px;
        border-left: 4px solid #ff6b6b;
        display: none;
      }
    </style>
  </head>
  <body class="login-page">
    <header class="header">
      <h1>Welcome to CodePulse</h1>
    </header>

    <main class="main-content">
      <section class="login-section section">
        <h2>Select Login Type</h2>
        <p>Please choose how you want to login</p>

        <!-- Initial Choice -->
        <div class="login-choice" id="loginChoice">
          <button class="login-btn" onclick="showStudentLogin()">
            Student Login
          </button>
          <button class="login-btn" onclick="showAdminLogin()">
            Admin Login
          </button>
        </div>

        <!-- Student Login -->
        <form id="studentLoginForm" class="login-form">
          <h2>Student Login</h2>
          <div class="input-group">
            <label for="studentUsername">Roll Number:</label>
            <input
              type="text"
              id="studentUsername"
              placeholder="Enter Roll Number"
              required
            />
          </div>
          <div class="input-group">
            <label for="studentPassword">Password:</label>
            <input
              type="password"
              id="studentPassword"
              placeholder="Enter Password"
              required
            />
          </div>
          <button type="submit" class="login-btn">Login</button>
          <button type="button" class="back-btn" onclick="goBack()">
            ⬅ Back
          </button>
          <div id="studentError" class="error-message"></div>
        </form>

        <!-- Admin Login -->
        <form id="adminLoginForm" class="login-form">
          <h2>Admin Login</h2>
          <div class="input-group">
            <label for="adminUsername">Admin ID:</label>
            <input
              type="text"
              id="adminUsername"
              placeholder="Enter Admin ID"
              required
            />
          </div>
          <div class="input-group">
            <label for="adminPassword">Password:</label>
            <input
              type="password"
              id="adminPassword"
              placeholder="Enter Password"
              required
            />
          </div>
          <button type="submit" class="login-btn">Login</button>
          <button type="button" class="back-btn" onclick="goBack()">
            ⬅ Back
          </button>
          <div id="adminError" class="error-message"></div>
        </form>
      </section>
    </main>

    <footer class="footer">
      <p>&copy; 2025 CodePulse. All rights reserved.</p>
    </footer>

    <script>
      // --- Toggle Forms ---
      function showStudentLogin() {
        document.getElementById("loginChoice").style.display = "none";
        document.getElementById("studentLoginForm").style.display = "block";
      }

      function showAdminLogin() {
        document.getElementById("loginChoice").style.display = "none";
        document.getElementById("adminLoginForm").style.display = "block";
      }

      function goBack() {
        document.getElementById("loginChoice").style.display = "flex";
        document.getElementById("studentLoginForm").style.display = "none";
        document.getElementById("adminLoginForm").style.display = "none";
        document.getElementById("studentError").style.display = "none";
        document.getElementById("adminError").style.display = "none";
      }

      // --- Student Login Logic (Updated) ---
      document
        .getElementById("studentLoginForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          const username = document
            .getElementById("studentUsername")
            .value.trim(); // roll number
          const password = document
            .getElementById("studentPassword")
            .value.trim();
          const error = document.getElementById("studentError");

          if (!username || !password) {
            error.textContent = "Please enter Roll Number and Password.";
            error.style.display = "block";
            return;
          }

          const raw = localStorage.getItem("codepulse_students");
          const students = raw ? JSON.parse(raw) : [];
          const student = students.find((s) => s.roll === username);

          if (!student) {
            error.textContent = "Student not found. Ask admin to add user.";
            error.style.display = "block";
            return;
          }

          if (student.password !== password) {
            error.textContent = "Incorrect password.";
            error.style.display = "block";
            return;
          }

          // Success
          sessionStorage.setItem("codepulse_student", student.roll);
          sessionStorage.setItem("codepulse_role", "student");
          alert("Login Successful! Redirecting...");
          window.location.href = "dashboard.html";
        });

      // --- Admin Login Logic ---
      document
        .getElementById("adminLoginForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          const username = document
            .getElementById("adminUsername")
            .value.trim();
          const password = document
            .getElementById("adminPassword")
            .value.trim();
          const error = document.getElementById("adminError");

          if (!username || !password) {
            error.textContent = "Please enter Admin ID and Password.";
            error.style.display = "block";
            return;
          }

          // Demo check (replace with backend)
          if (username === "admin" && password === "admin") {
            sessionStorage.setItem("codepulse_admin", "true");
            sessionStorage.setItem("codepulse_role", "admin");

            alert("Admin Login Successful! Redirecting...");
            window.location.href = "admin.html";
          } else {
            error.textContent = "Invalid Admin credentials.";
            error.style.display = "block";
          }
        });
    </script>
  </body>
</html>
